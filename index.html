<!-- assets/index.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Teachable Machine Classifier</title>

    <!-- âœ… ìµœì‹  ì•ˆì • ë²„ì „ì˜ TensorFlow.js (ë¸Œë¼ìš°ì €ìš©) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.13.0/dist/tf.min.js"></script>

    <!-- âœ… Teachable Machine ì´ë¯¸ì§€ ëª¨ë¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ë¸Œë¼ìš°ì €ìš© ëª…ì‹œ ë²„ì „) -->
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>

    <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
      text-align: center;
    }
    img {
      width: 200px;
      height: auto;
      margin-top: 10px;
    }
    #result {
      margin-top: 16px;
      font-size: 18px;
      color: #333;
    }
  </style>
</head>

<body>
<h2>Teachable Machine ì˜ˆì¸¡</h2>
<img id="preview" src="" alt="ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€" />
<div id="result">ì˜ˆì¸¡ ê²°ê³¼ ëŒ€ê¸° ì¤‘...</div>

<script>
  // âœ… Teachable Machine ëª¨ë¸ ê²½ë¡œ
    const MODEL_URL = "https://teachablemachine.withgoogle.com/models/tTrJVw9oX/";

    let model = null; // ëª¨ë¸ì„ ì „ì—­ì— ì €ì¥í•˜ì—¬ ì¬ì‚¬ìš©

    tf.setBackend('cpu').then(() => tf.ready()).then(() => {
    console.log("âœ… TensorFlow.js is ready with CPU backend");
  }).catch(err => {
    console.error("âŒ TensorFlow.js ì´ˆê¸°í™” ì˜¤ë¥˜:", err);
  });

    // âœ… Flutterì—ì„œ í˜¸ì¶œí•  í•¨ìˆ˜ (Base64 ì´ë¯¸ì§€ ì „ë‹¬ë¨)
async function loadImageFromFlutter(base64Image) {
  const imgElement = document.getElementById("preview");

  // ëª¨ë¸ë¶€í„° ë¡œë“œ (ì—†ìœ¼ë©´)
  if (!model) {
    console.log("ğŸ“¦ ëª¨ë¸ ë¡œë”© ì‹œì‘...");
    model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
    console.log("ğŸ“¦ ëª¨ë¸ ë¡œë”© ì™„ë£Œ!");
  }

  // onload ë¨¼ì € ë“±ë¡
  imgElement.onload = async () => {
    console.log("ğŸ–¼ï¸ ì´ë¯¸ì§€ ë¡œë”© ì™„ë£Œ, ì˜ˆì¸¡ ì‹œì‘...");
    const prediction = await model.predict(imgElement);

    let best = prediction[0];
    for (let i = 1; i < prediction.length; i++) {
      if (prediction[i].probability > best.probability) {
        best = prediction[i];
      }
    }
     const resultT = best.className + ": " + best.probability.toFixed(2);
    const resultText = best.className;
    document.getElementById("result").innerText = resultText;
    console.log("âœ…resultText", resultText);

    if (window.ResultChannel) {
      ResultChannel.postMessage(resultText);
    } else {
      alert("ResultChannel ì—†ìŒ");
    }
  };

  // ê·¸ë¦¬ê³  ë‚˜ì„œ ì´ë¯¸ì§€ src ì„¤ì •
  imgElement.src = base64Image;
}
  </script>
</body>
</html>
